<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Colecci칩n | MetaMapa</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family:'DM Sans', sans-serif; margin:0; background:#f9fafb; }
        nav { background:white; border-bottom:1px solid #ddd; padding:1rem 2rem; }
        .nav-container { max-width:800px; margin:auto; display:flex; justify-content:space-between; align-items:center; }
        .logo { font-weight:700; font-size:1.5rem; color:#0891b2; text-decoration:none; }
        main { max-width:800px; margin:2rem auto; padding:2rem; background:white; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
        label { font-weight:600; display:block; margin-top:1rem; }
        input, textarea, select { width:100%; padding:0.75rem; margin-top:0.3rem; border:1px solid #ddd; border-radius:6px; }
        .btn { padding:0.7rem 1.2rem; border:none; border-radius:6px; cursor:pointer; font-weight:600; margin-top:1.5rem; }
        .btn-primary { background:#0891b2; color:white; }
        .btn-secondary { background:#6b7280; color:white; }
        .form-actions { display:flex; gap:1rem; margin-top:2rem; }
        .fuente-group { display:flex; gap:1rem; align-items:center; margin-bottom:1rem; }
        .remove-btn { background:#ef4444; color:white; border-radius:6px; padding:0.5rem; cursor:pointer; }
    </style>
</head>
<body>

<div th:replace="layout/navbar :: navbar( ${rol})"></div>

<main>
    <h1 th:text="${coleccion.id != null} ? 'Editar Colecci칩n' : 'Nueva Colecci칩n'">Nueva Colecci칩n</h1>

    <form th:action="@{/createColeccion}" th:object="${coleccion}" method="post">
        <input type="hidden" th:field="*{id}" />

        <label>T칤tulo</label>
        <input type="text" th:field="*{titulo}" required>

        <label>Descripci칩n</label>
        <textarea th:field="*{descripcion}" required></textarea>

        <label>Fuentes</label>
        <div id="fuentesContainer">
            <div class="fuente-group" th:each="fuente, iterStat : *{fuentes}">
                <select th:field="*{fuentes[__${iterStat.index}__].origen}" required>
                    <option value="ESTATICO">Est치tica</option>
                    <option value="DINAMICO">Din치mica</option>
                    <option value="PROXY">Proxy</option>
                </select>

                <button type="button" class="remove-btn" onclick="removeFuente(this)">칑</button>
            </div>
        </div>

        <button type="button" class="btn btn-secondary" onclick="addFuente()">+ Agregar Fuente</button>

        <label>Estrategia de Consenso</label>
        <select th:field="*{estrategiaConsenso}" required>
            <option value="MULTIPLE_MENCION">M칰ltiples menciones</option>
            <option value="ABSOLUTA">Absoluta</option>
            <option value="MAYORIA">Mayor칤a simple</option>
        </select>

        <label>Categor칤a</label>
        <input type="text" th:field="*{criterios[0].categoria}" placeholder="Escrib칤 una categor칤a">
        <input type="hidden" th:field="*{criterios[0].tipo}" value="categoria" />

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">游 Guardar</button>
            <a th:href="@{/administrador}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</main>

<script>
    function addFuente() {
        const container = document.getElementById("fuentesContainer");
        const index = container.children.length;

        const div = document.createElement("div");
        div.className = "fuente-group";

        div.innerHTML = `
            <select name="fuentes[${index}].origenS" required>
              <option value="ESTATICO">Est치tica</option>
              <option value="DINAMICO">Din치mica</option>
              <option value="PROXY">Proxy</option>
            </select>
            <button type="button" class="remove-btn" onclick="removeFuente(this)">칑</button>
        `;

        container.appendChild(div);
    }

    function removeFuente(btn) {
        btn.parentElement.remove();
        const container = document.getElementById("fuentesContainer");

        Array.from(container.children).forEach((div, idx) => {
            div.querySelectorAll("select").forEach(select => {
                select.name = `fuentes[${idx}].tipo`;
            });
        });
    }
</script>

</body>
</html>
