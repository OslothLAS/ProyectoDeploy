<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Hecho - MetaMapa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        /* Responsive styles */
        @media (max-width: 768px) {
            .container {
                padding: 1rem !important;
            }
            .hecho-card {
                padding: 1.5rem !important;
            }
            .hecho-title {
                font-size: 1.5rem !important;
            }
            .hecho-info-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            .galeria-grid {
                grid-template-columns: 1fr !important;
            }
        }
        @media (max-width: 480px) {
            .hecho-card {
                padding: 1rem !important;
            }
            .hecho-title {
                font-size: 1.25rem !important;
            }
            .categoria-badge {
                font-size: 0.875rem !important;
            }
        }
    </style>
</head>
<body>
<!-- Importing navbar from layout -->
<div th:replace="layout/navbar :: navbar( ${rol})"></div>

<!-- Contenedor principal cuando existe el hecho -->
<div class="container" th:if="${hecho}">
    <article class="hecho-card">
        <!-- Encabezado del hecho con badge -->
        <header style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2rem;">
            <!-- Badge de categoría arriba -->
            <div th:if="${hecho.categoria}">
        <span class="categoria-badge" style="display: inline-flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
            <i data-lucide="tag"></i>
            <span th:text="${hecho.categoria}">Categoría</span>
        </span>
            </div>
            <!-- Título -->
            <h1 th:text="${hecho.titulo}" class="hecho-title" style="margin: 0; word-break: break-word;">Título del hecho</h1>
            <!-- Autor -->
            <p style="margin: 0; color: var(--text-light); font-style: italic; word-break: break-word;">
                AUTOR: <span th:text="${hecho.mostrarDatos} ? ${hecho.username} : 'Anónimo'">nombre_usuario</span>
            </p>
        </header>

        <!-- Grid de información organizada -->
        <section class="hecho-info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <!-- Estado -->
            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                <strong style="font-size: 0.875rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">Estado</strong>
                <span th:text="${hecho.esValido ? 'Verificado' : 'Invalido'}" style="font-size: 1rem; color: var(--text-color);">Estado</span>
            </div>
            <!-- Fecha de publicación -->
            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                <strong style="font-size: 0.875rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">Publicado</strong>
                <span th:text="${#temporals.format(hecho.fechaCreacion, 'dd/MM/yyyy HH:mm')}" style="font-size: 1rem; color: var(--text-color); word-break: break-word;">Fecha</span>
            </div>
            <!-- Fecha del hecho -->
            <div class="info-item" style="display: flex; flex-direction: column; gap: 0.25rem;">
                <strong style="font-size: 0.875rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">Fecha del hecho</strong>
                <span th:text="${#temporals.format(hecho.fechaHecho, 'dd/MM/yyyy')}" style="font-size: 1rem; color: var(--text-color);">Fecha</span>
            </div>
            <!-- Ubicación -->
            <div class="info-item"
                 th:if="${hecho.ubicacion != null and hecho.ubicacion.localidad.nombre != 'AUN NO DEFINIDO'}"
                 style="display: flex; flex-direction: column; gap: 0.25rem;">
                <strong style="font-size: 0.875rem; color: var(--text-light); text-transform: uppercase; letter-spacing: 0.05em;">Ubicación</strong>
                <div style="display: flex; flex-direction: column;">
                    <span th:text="${hecho.ubicacion.localidad.nombre}"
                    style="font-size: 1rem; color: var(--text-color); word-break: break-word;">Localidad</span>
                </div>
            </div>
        </section>

        <!-- Galería multimedia -->
        <section class="galeria-section" th:if="${hecho.multimedia != null and !hecho.multimedia.isEmpty()}" style="margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1rem; font-size: 1.25rem; font-weight: 600;">Multimedia</h3>
            <div class="galeria-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem;">
                <figure class="imagen-item" th:each="media : ${hecho.multimedia}" ...>
                    <img th:src="@{${backendUrl} + ${media.url}}"
                         th:alt="'Imagen del hecho: ' + ${hecho.titulo}"
                         class="img-zoom"
                         style="width: 100%; height: auto; display: block; cursor: pointer;">
                </figure>
            </div>
        </section>

        <!-- Descripción -->
        <section class="descripcion" th:if="${hecho.descripcion}" style="margin-bottom: 2rem;">
            <h3 style="margin-bottom: 1rem; font-size: 1.25rem; font-weight: 600;">Descripción</h3>
            <p th:text="${hecho.descripcion}" style="line-height: 1.6; color: var(--text-color); word-break: break-word;">Descripción del hecho...</p>
        </section>

        <!-- Mensaje si no hay descripción -->
        <section class="descripcion" th:unless="${hecho.descripcion}" style="margin-bottom: 2rem;">
            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 1rem; background: var(--surface); border-radius: 0.5rem; color: var(--text-light); font-style: italic; flex-wrap: wrap;">
                <i data-lucide="info" style="width: 20px; height: 20px; flex-shrink: 0;"></i>
                <span>Este hecho no tiene descripción disponible.</span>
            </div>
        </section>

        <!-- Información de edición -->
        <aside th:if="${hecho.editable}" style="display: flex; align-items: start; gap: 1rem; padding: 1rem; background: var(--surface); border-radius: 0.5rem; border-left: 3px solid var(--secondary-color); flex-wrap: wrap;">
            <i data-lucide="edit-3" style="width: 20px; height: 20px; color: var(--secondary-color); flex-shrink: 0; margin-top: 0.125rem;"></i>
            <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1; min-width: 200px;">
                <strong style="font-weight: 600; color: var(--secondary-color);">Estado de edición</strong>
                <span style="color: var(--text-color); font-size: 0.9375rem;">Este hecho aún puede ser editado (dentro del período de 7 días)</span>
            </div>
        </aside>

        <div style="margin-top: 2rem; display: flex; justify-content: flex-end; flex-wrap: wrap;">

            <!-- Botón EDITAR cuando la localidad es "AUN NO DEFINIDO" -->
            <a th:if="${hecho.ubicacion != null  and hecho.ubicacion.localidad.nombre == 'AUN NO DEFINIDO' and hecho.editable}"
               th:href="@{'/edicionHecho/' + ${hecho.id}}"
               class="btn"
               style="width: auto; min-width: fit-content; background-color: #F59E0BFF; color: white; border: none;">
                <i data-lucide="edit-3"></i>
                <span>Editar</span>
            </a>

            <!-- Botón ELIMINAR cuando NO es "AUN NO DEFINIDO" -->
            <a th:if="${hecho.ubicacion != null and hecho.ubicacion.localidad.nombre != 'AUN NO DEFINIDO'}"
               th:href="@{/solicitar-eliminacion(id=${hecho.id})}"
               class="btn btn-danger"
               style="width: auto; min-width: fit-content;">
                <i data-lucide="trash-2"></i>
                <span>Eliminar</span>
            </a>

        </div>


    </article>
</div>

<!-- Mensaje si no se encuentra el hecho -->
<div class="container" th:unless="${hecho}">
    <section style="display: flex; flex-direction: column; align-items: center; text-align: center; padding: 4rem 2rem;">
        <i data-lucide="alert-circle" style="width: 64px; height: 64px; color: var(--text-light); margin-bottom: 1.5rem;"></i>
        <h2 style="color: var(--text-color); margin-bottom: 1rem; font-size: 1.5rem; font-weight: 600;">Hecho no encontrado</h2>
        <p style="color: var(--text-light); margin-bottom: 2rem; max-width: 500px;">
            El hecho que buscas no existe o no tienes permisos para verlo.
        </p>
        <a href="/mis-contribuciones" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 0.5rem;">
            <i data-lucide="arrow-left"></i>
            <span>Volver a mis contribuciones</span>
        </a>
    </section>
</div>

<!-- Importing footer from layout -->
<div th:replace="~{layout/footer :: footer}"></div>

<script>
    lucide.createIcons();
    document.addEventListener('DOMContentLoaded', () => {
        const imagenes = document.querySelectorAll('.imagen-item');
        imagenes.forEach(imagen => {
            imagen.addEventListener('mouseenter', () => {
                imagen.style.transform = 'scale(1.02)';
            });
            imagen.addEventListener('mouseleave', () => {
                imagen.style.transform = 'scale(1)';
            });
        });
    });

    document.addEventListener('DOMContentLoaded', () => {
        // 1. Obtener elementos
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        const captionText = document.getElementById("caption");
        const closeBtn = document.getElementsByClassName("close-btn")[0];

        // 2. Seleccionar todas las imágenes con la clase 'img-zoom'
        const images = document.querySelectorAll('.img-zoom');

        // 3. Agregar evento click a cada imagen
        images.forEach(img => {
            img.addEventListener('click', function() {
                modal.style.display = "block"; // Mostrar modal
                modalImg.src = this.src;       // Poner la misma URL de la imagen clickeada

                // Opcional: Poner el texto alt como descripción
                if(captionText && this.alt) {
                    captionText.innerHTML = this.alt;
                    captionText.style.color = "#ccc";
                    captionText.style.textAlign = "center";
                    captionText.style.padding = "10px";
                }
            });
        });

        // 4. Función para cerrar el modal
        function closeModal() {
            modal.style.display = "none";
        }

        // Cerrar al hacer click en la X
        closeBtn.onclick = closeModal;

        // Cerrar al hacer click fuera de la imagen (en el fondo negro)
        modal.onclick = function(event) {
            if (event.target === modal) {
                closeModal();
            }
        }

        // Cerrar con la tecla ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeModal();
            }
        });
    });
</script>



<div id="imageModal" class="modal-overlay">
    <span class="close-btn">&times;</span>
    <img class="modal-content" id="modalImage">
    <div id="caption"></div>
</div>

</body>
</html>