@startuml
' --- Configuración Visual ---
skinparam classAttributeIconSize 0
skinparam linetype ortho
left to right direction

' --- Módulo de Usuarios y Roles ---
package "Usuarios" {
    abstract class Usuario {
        +String nombre
        +String apellido
        ..
        +reportarFalla(Monopatin, MotivoReporte)
    }

    class Monopatinador extends Usuario {
        +String tipoDocumento
        +String nroDocumento
        +String nacionalidad
        +String domicilio
        +String urlFotoRostro
        +Boolean validadoRENAPER
        ..
        +calcularCosto(Viaje)
    }

    class Administrador extends Usuario {
        +String legajo
        ..
        +gestionarTarifas()
        +gestionarMonopatines()
    }

    class MedioDeContacto {
        +TipoContacto tipo
        +String valor
    }

    enum TipoContacto {
        EMAIL
        TELEFONO
    }

    ' Relaciones de Usuarios
    Monopatinador "1" *-- "2..*" MedioDeContacto
    MedioDeContacto -- TipoContacto
}

' --- Módulo de Estructura (Estaciones y Comunas) ---
package "Infraestructura" {
    class Estacion {
        +String direccion
        +GeoCoordenadas coordenadas
        +int capacidadPuestos
    }

    class Comuna {
        +int numero
    }

    ' Relaciones de Infraestructura
    Administrador "1" -- "0..*" Comuna : "comunasAsignadas"
    Estacion "1" -- "1" Comuna
}

' --- Módulo de Monopatines y Estados ---
package "Flota" {
    class Monopatin {
        +String marca
        +String modelo
        +String color
        +int aniosVidaUtilBateria
        +EstadoMonopatin estado
    }

    enum EstadoMonopatin {
        DISPONIBLE
        NO_DISPONIBLE
        EN_REPARACION
        EN_USO
    }

    class Reparacion {
        +LocalDateTime fecha
        +String descripcion
    }

    ' Relaciones de Flota
    Monopatin -- EstadoMonopatin
    Monopatin "1" *-- "0..*" Reparacion : "historial"
    ' Un monopatin está en 0 o 1 estación
    Monopatin "0..*" -- "0..1" Estacion : "estacionadoEn"
}


' --- Módulo Transaccional (Viajes y Reportes) ---
package "Transacciones" {
    class Viaje {
        +LocalDateTime fechaHoraRetiro
        +LocalDateTime fechaHoraDevolucion
        +float kilometrosRealizados
    }

    class ReporteFalla {
        +LocalDateTime fechaHoraDeteccion
        +List<String> urlsFotos
        +String descripcionManual
    }

    class MotivoReporte {
        +String nombre
        ' Si es true, habilita el campo descripcionManual
        +Boolean esOtro
    }

    ' Relaciones Transaccionales
    ' Un viaje conecta un monopatinador, un monopatin y estaciones
    Viaje "0..*" -- "1" Monopatinador : "realizadoPor"
    Viaje "0..*" -- "1" Monopatin : "utiliza"
    Viaje "0..*" -- "1" Estacion : "origen"
    Viaje "0..*" -- "1" Estacion : "destino"

    ' Un reporte es hecho por un Usuario (Admin o Monopatinador)
    ReporteFalla "0..*" -- "1" Usuario : "reportadoPor"
    ReporteFalla "0..*" -- "1" Monopatin : "sobre"
    ReporteFalla "1" -- "1..*" MotivoReporte : "motivo"
}

' --- Módulo de Configuración (Tarifas) ---
package "Configuracion" {
    class Tarifa {
        +String descripcion
        +float costoMinimoUso
        +float costoAnual
        +float tarifaBaseExtranjero
        +float costoPorKmExtranjero
    }
    ' Aquí faltaría el Patrón Strategy para los factores
    ' (clima, feriado), pero la Tarifa base la gestiona el Admin
    Administrador "1" -- "*" Tarifa : "gestiona"
}
@enduml